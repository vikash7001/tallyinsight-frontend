<script>
const API = 'https://tallyinsight-backend-1.onrender.com';

function createCompany() {
  const name = document.getElementById('company').value.trim();
  const adminId = localStorage.getItem('x-user-id');

  if (!adminId) {
    document.getElementById('error').textContent = 'Missing admin session';
    return;
  }

  if (!name) {
    document.getElementById('error').textContent = 'Enter company name';
    return;
  }

  fetch(`${API}/companies/create`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-user-id': adminId
    },
    body: JSON.stringify({
      company_name: name
    })
  })
  .then(res => res.ok ? res.json() : res.json().then(e => Promise.reject(e)))
  .then(data => {
    localStorage.setItem('x-company-id', data.company_id);
    window.location.href = 'subscription.html';
  })
  .catch(err => {
    console.error(err);
    document.getElementById('error').textContent =
      err?.error || 'Company creation failed';
  });
}
</script>
