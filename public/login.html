<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TallyInsight – Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
<div class="page">

  <!-- ===== Header ===== -->
  <header>
    <div class="container header-inner">
      <div class="logo">TallyInsight</div>
    </div>
  </header>

  <!-- ===== Login Section ===== -->
  <section class="hero">
    <div class="container" style="max-width:420px;">
      <h1 style="font-size:28px; margin-bottom:10px;">Admin Login</h1>
      <p style="font-size:14px; color:var(--text-muted); margin-bottom:24px;">
        Login using your registered mobile number.
      </p>

      <!-- Mobile -->
      <label style="font-size:13px;">Mobile Number</label>
      <input
        id="mobile"
        type="text"
        placeholder="10-digit mobile number"
        style="width:100%; padding:10px; margin:6px 0 16px;
               border:1px solid var(--border-light); border-radius:6px;"
      />

      <button
        id="sendOtpBtn"
        class="btn btn-outline"
        style="width:100%; margin-bottom:20px;"
        onclick="sendOtp()"
      >
        Send OTP
      </button>

      <!-- OTP -->
      <div id="otpSection" style="display:none;">
        <label style="font-size:13px;">OTP</label>
        <input
          id="otp"
          type="text"
          placeholder="Enter OTP"
          style="width:100%; padding:10px; margin:6px 0 16px;
                 border:1px solid var(--border-light); border-radius:6px;"
        />

        <button
          class="btn btn-primary"
          style="width:100%;"
          onclick="verifyOtp()"
        >
          Verify & Login
        </button>
      </div>

      <div
        id="error"
        style="margin-top:16px; font-size:13px; color:#dc2626; display:none;">
      </div>
    </div>
  </section>

  <!-- ===== Footer ===== -->
  <footer>
    © TallyInsight. All rights reserved.
  </footer>

</div>

<script>
const API_BASE = 'https://tallyinsight-backend-1.onrender.com';

function showError(msg) {
  const el = document.getElementById('error');
  el.textContent = msg;
  el.style.display = 'block';
}

function sendOtp() {
  const mobile = document.getElementById('mobile').value.trim();

  if (!/^\d{10}$/.test(mobile)) {
    showError('Enter a valid 10-digit mobile number');
    return;
  }

  fetch(`${API_BASE}/send-otp`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ mobile })
  })
  .then(res => {
    if (!res.ok) throw new Error('OTP send failed');
    document.getElementById('otpSection').style.display = 'block';
    document.getElementById('error').style.display = 'none';
  })
  .catch(() => showError('Failed to send OTP'));
}

function verifyOtp() {
  const mobile = document.getElementById('mobile').value.trim();
  const otp = document.getElementById('otp').value.trim();

  if (!otp) {
    showError('Enter OTP');
    return;
  }

  fetch(`${API_BASE}/verify-otp`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ mobile, otp })
  })
  .then(res => res.ok ? res.json() : Promise.reject())
  .then(data => {
    localStorage.setItem('x-company-id', data.companyId);
    localStorage.setItem('x-user-id', data.userId);
    window.location.href = 'dashboard.html';
  })
  .catch(() => showError('Invalid or expired OTP'));
}
</script>

</body>
</html>
